<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    {{- partial "head" -}}
    <title>{{.Site.Title}}</title>
  </head>
  <body>
    <div id="canvas"></div>

    <div class="container">
      <div>
        <div>{{- partial "header" . -}}</div>
        <div>
          <ul>
            {{ range .Site.RegularPages }}
            <li>
              <a href="{{.RelPermalink}}" title="{{.Title}}"> {{.Title}} </a>
            </li>
            {{ end }}
          </ul>
        </div>
      </div>
    </div>

    <script>
      let rectColors = ["#ff0000", "#0000ff", "#ffff00", "#000000", "#ffffff"];
      let rects = [];
      let draggedRect = null;
      let dragOffset = { x: 0, y: 0 };

      function setup() {
        let myCanvas = createCanvas(windowWidth / 2, windowHeight);
        myCanvas.parent("canvas");
        myCanvas.position(windowWidth / 2, 0);

        let scaleFactor = windowHeight / 700;
        rects = [
          {
            x: 0,
            y: 0,
            w: 50 * scaleFactor,
            h: 200 * scaleFactor,
            color: "#ff0000",
          },
          {
            x: 200 * scaleFactor,
            y: 0,
            w: 150 * scaleFactor,
            h: 200 * scaleFactor,
            color: "#ffff00",
          },
          {
            x: 300 * scaleFactor,
            y: 0,
            w: 200 * scaleFactor,
            h: 200 * scaleFactor,
            color: "#0000ff",
          },
          {
            x: 0,
            y: 200 * scaleFactor,
            w: 150 * scaleFactor,
            h: 200 * scaleFactor,
            color: "#ffffff",
          },
          {
            x: 100 * scaleFactor,
            y: 200 * scaleFactor,
            w: 100 * scaleFactor,
            h: 100 * scaleFactor,
            color: "#ffffff",
          },
          {
            x: 300 * scaleFactor,
            y: 200 * scaleFactor,
            w: 200 * scaleFactor,
            h: 200 * scaleFactor,
            color: "#ffffff",
          },
          {
            x: 100 * scaleFactor,
            y: 300 * scaleFactor,
            w: 150 * scaleFactor,
            h: 100 * scaleFactor,
            color: "#000000",
          },
          {
            x: 400 * scaleFactor,
            y: 200 * scaleFactor,
            w: 100 * scaleFactor,
            h: 200 * scaleFactor,
            color: "#000000",
          },
          {
            x: 500 * scaleFactor,
            y: 200 * scaleFactor,
            w: 100 * scaleFactor,
            h: 200 * scaleFactor,
            color: "#000000",
          },

          {
            x: 0,
            y: 400 * scaleFactor,
            w: 150 * scaleFactor,
            h: 100 * scaleFactor,
            color: "#ff0000",
          },
          {
            x: 150 * scaleFactor,
            y: 400 * scaleFactor,
            w: 150 * scaleFactor,
            h: 100 * scaleFactor,
            color: "#0000ff",
          },
          {
            x: 300 * scaleFactor,
            y: 400 * scaleFactor,
            w: 150 * scaleFactor,
            h: 100 * scaleFactor,
            color: "#ffff00",
          },
          {
            x: 450 * scaleFactor,
            y: 400 * scaleFactor,
            w: 150 * scaleFactor,
            h: 100 * scaleFactor,
            color: "#ffffff",
          },

          {
            x: 0,
            y: 500 * scaleFactor,
            w: 120 * scaleFactor,
            h: 100 * scaleFactor,
            color: "#0000ff",
          },
          {
            x: 120 * scaleFactor,
            y: 500 * scaleFactor,
            w: 120 * scaleFactor,
            h: 100 * scaleFactor,
            color: "#ffff00",
          },
          {
            x: 240 * scaleFactor,
            y: 500 * scaleFactor,
            w: 120 * scaleFactor,
            h: 100 * scaleFactor,
            color: "#000000",
          },
          {
            x: 360 * scaleFactor,
            y: 500 * scaleFactor,
            w: 120 * scaleFactor,
            h: 100 * scaleFactor,
            color: "#ff0000",
          },
          {
            x: 480 * scaleFactor,
            y: 500 * scaleFactor,
            w: 120 * scaleFactor,
            h: 100 * scaleFactor,
            color: "#ffffff",
          },

          {
            x: 0,
            y: 600 * scaleFactor,
            w: 200 * scaleFactor,
            h: 150 * scaleFactor,
            color: "#ffff00",
          },
          {
            x: 200 * scaleFactor,
            y: 600 * scaleFactor,
            w: 200 * scaleFactor,
            h: 150 * scaleFactor,
            color: "#ffffff",
          },
          {
            x: 400 * scaleFactor,
            y: 600 * scaleFactor,
            w: 200 * scaleFactor,
            h: 150 * scaleFactor,
            color: "#0000ff",
          },

          {
            x: 0,
            y: 750 * scaleFactor,
            w: 100 * scaleFactor,
            h: 100 * scaleFactor,
            color: "#000000",
          },
          {
            x: 100 * scaleFactor,
            y: 750 * scaleFactor,
            w: 100 * scaleFactor,
            h: 100 * scaleFactor,
            color: "#ff0000",
          },
          {
            x: 200 * scaleFactor,
            y: 750 * scaleFactor,
            w: 100 * scaleFactor,
            h: 100 * scaleFactor,
            color: "#ffffff",
          },
          {
            x: 300 * scaleFactor,
            y: 750 * scaleFactor,
            w: 100 * scaleFactor,
            h: 100 * scaleFactor,
            color: "#0000ff",
          },
          {
            x: 400 * scaleFactor,
            y: 750 * scaleFactor,
            w: 100 * scaleFactor,
            h: 100 * scaleFactor,
            color: "#ffff00",
          },
          {
            x: 500 * scaleFactor,
            y: 750 * scaleFactor,
            w: 100 * scaleFactor,
            h: 100 * scaleFactor,
            color: "#000000",
          },

          {
            x: 0,
            y: 850 * scaleFactor,
            w: 180 * scaleFactor,
            h: 120 * scaleFactor,
            color: "#ff0000",
          },
          {
            x: 180 * scaleFactor,
            y: 850 * scaleFactor,
            w: 180 * scaleFactor,
            h: 120 * scaleFactor,
            color: "#ffffff",
          },
          {
            x: 360 * scaleFactor,
            y: 850 * scaleFactor,
            w: 180 * scaleFactor,
            h: 120 * scaleFactor,
            color: "#0000ff",
          },
          {
            x: 540 * scaleFactor,
            y: 850 * scaleFactor,
            w: 60 * scaleFactor,
            h: 120 * scaleFactor,
            color: "#000000",
          },

          {
            x: 0,
            y: 970 * scaleFactor,
            w: 150 * scaleFactor,
            h: 80 * scaleFactor,
            color: "#ffff00",
          },
          {
            x: 150 * scaleFactor,
            y: 970 * scaleFactor,
            w: 150 * scaleFactor,
            h: 80 * scaleFactor,
            color: "#0000ff",
          },
          {
            x: 300 * scaleFactor,
            y: 970 * scaleFactor,
            w: 150 * scaleFactor,
            h: 80 * scaleFactor,
            color: "#ffffff",
          },
          {
            x: 450 * scaleFactor,
            y: 970 * scaleFactor,
            w: 150 * scaleFactor,
            h: 80 * scaleFactor,
            color: "#ff0000",
          },

          {
            x: 0,
            y: 1050 * scaleFactor,
            w: 120 * scaleFactor,
            h: 100 * scaleFactor,
            color: "#000000",
          },
          {
            x: 120 * scaleFactor,
            y: 1050 * scaleFactor,
            w: 120 * scaleFactor,
            h: 100 * scaleFactor,
            color: "#ffffff",
          },
          {
            x: 240 * scaleFactor,
            y: 1050 * scaleFactor,
            w: 120 * scaleFactor,
            h: 100 * scaleFactor,
            color: "#ff0000",
          },
          {
            x: 360 * scaleFactor,
            y: 1050 * scaleFactor,
            w: 120 * scaleFactor,
            h: 100 * scaleFactor,
            color: "#0000ff",
          },
          {
            x: 480 * scaleFactor,
            y: 1050 * scaleFactor,
            w: 120 * scaleFactor,
            h: 100 * scaleFactor,
            color: "#ffff00",
          },

          {
            x: 0,
            y: 1150 * scaleFactor,
            w: 200 * scaleFactor,
            h: 150 * scaleFactor,
            color: "#ffffff",
          },
          {
            x: 200 * scaleFactor,
            y: 1150 * scaleFactor,
            w: 200 * scaleFactor,
            h: 150 * scaleFactor,
            color: "#000000",
          },
          {
            x: 400 * scaleFactor,
            y: 1150 * scaleFactor,
            w: 200 * scaleFactor,
            h: 150 * scaleFactor,
            color: "#ff0000",
          },
        ];
      }

      function draw() {
        background(255);

        for (let i = 0; i < rects.length; i++) {
          let rectObj = rects[i];
          fill(rectObj.color);
          rect(rectObj.x, rectObj.y, rectObj.w, rectObj.h);
          strokeWeight(50);
        }

        if (draggedRect) {
          for (let i = 0; i < rects.length; i++) {
            let rectObj = rects[i];
            if (
              rectObj !== draggedRect &&
              isIntersecting(draggedRect, rectObj)
            ) {
              let overlapRect = getOverlapRect(draggedRect, rectObj);
              fill(getRandomColor());
              rect(overlapRect.x, overlapRect.y, overlapRect.w, overlapRect.h);
            }
          }
        }
      }

      function mousePressed() {
        for (let i = rects.length - 1; i >= 0; i--) {
          let rectObj = rects[i];
          if (
            mouseX >= rectObj.x &&
            mouseX <= rectObj.x + rectObj.w &&
            mouseY >= rectObj.y &&
            mouseY <= rectObj.y + rectObj.h
          ) {
            draggedRect = rectObj;
            dragOffset.x = mouseX - rectObj.x;
            dragOffset.y = mouseY - rectObj.y;
            break;
          }
        }
      }

      function mouseDragged() {
        if (draggedRect) {
          draggedRect.x = mouseX - dragOffset.x;
          draggedRect.y = mouseY - dragOffset.y;
        }
      }

      function mouseReleased() {
        if (draggedRect) {
          // 스프링 효과와 함께 위치 변경
          let startX = draggedRect.x;
          let startY = draggedRect.y;
          let endX = mouseX - dragOffset.x;
          let endY = mouseY - dragOffset.y;
          let startTime = millis();
          let duration = 500;

          function animate() {
            let elapsed = millis() - startTime;
            let t = elapsed / duration;
            t = t * t * (3 - 2 * t); // 이징 함수 적용 (ease-in-out)

            if (elapsed < duration) {
              draggedRect.x = lerp(startX, endX, t);
              draggedRect.y = lerp(startY, endY, t);
              requestAnimationFrame(animate);
            } else {
              draggedRect.x = endX;
              draggedRect.y = endY;
            }
          }

          animate();
        }
        draggedRect = null;
      }

      function isIntersecting(rect1, rect2) {
        return (
          rect1.x < rect2.x + rect2.w &&
          rect1.x + rect1.w > rect2.x &&
          rect1.y < rect2.y + rect2.h &&
          rect1.y + rect1.h > rect2.y
        );
      }

      function getOverlapRect(rect1, rect2) {
        let left = Math.max(rect1.x, rect2.x);
        let right = Math.min(rect1.x + rect1.w, rect2.x + rect2.w);
        let top = Math.max(rect1.y, rect2.y);
        let bottom = Math.min(rect1.y + rect1.h, rect2.y + rect2.h);

        let overlapRect = {
          x: left,
          y: top,
          w: right - left,
          h: bottom - top,
        };

        return overlapRect;
      }

      function getRandomColor() {
        let letters = "0123456789ABCDEF";
        let color = "#";
        for (let i = 0; i < 6; i++) {
          color += letters[Math.floor(Math.random() * 16)];
        }
        return color;
      }

      function windowResized() {
        resizeCanvas(windowWidth / 2, windowHeight);

        let scaleFactor = windowHeight / 400;

        for (let i = 0; i < rects.length; i++) {
          rects[i].x *= scaleFactor;
          rects[i].y *= scaleFactor;
          rects[i].w *= scaleFactor;
          rects[i].h *= scaleFactor;
        }
      }
    </script>
  </body>
</html>
