<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    {{- partial "head" -}}
    <title>{{.Site.Title}}</title>
  </head>
  <body>
    <div id="canvas"></div>

    <div class="container">
      <div>
        <div>{{- partial "header" . -}}</div>
        <div>
          <ul>
            {{ range .Site.RegularPages }}
            <li>
              <a href="{{.RelPermalink}}" title="{{.Title}}">
                <h3>{{.Title}}</h3>
              </a>
            </li>
            {{ end }}
          </ul>
        </div>
      </div>
    </div>

    <script>
    let rectColors = ["#ff0000", "#0000ff", "#ffff00", "#ffffff"];
let rects = [];
let swapInterval = 3000;
let swapDuration = 1000; // 1초 동안 Swap 애니메이션 진행
let swapStartTime = 0;
let swappingRects = [];
let isSwapping = false; // Swap 애니메이션 진행 여부를 추적하는 변수

function setup() {
  let myCanvas = createCanvas(windowWidth/2, windowHeight);
  myCanvas.mouseClicked(swapRects);
  myCanvas.position(windowWidth - windowWidth/2, 0);

  let scaleFactor = windowHeight / 400;

  rects = [
    { x: 0, y: 0, w: 300 * scaleFactor, h: 200 * scaleFactor, color: "#ff0000" },
    { x: 300 * scaleFactor, y: 0, w: 50 * scaleFactor, h: 200 * scaleFactor, color: "#ffff00" },
    { x: 400 * scaleFactor, y: 0, w: 200 * scaleFactor, h: 200 * scaleFactor, color: "#0000ff" },
    { x: 0, y: 200 * scaleFactor, w: 200 * scaleFactor, h: 200 * scaleFactor, color: "#ffffff" },
    { x: 100 * scaleFactor, y: 200 * scaleFactor, w: 50 * scaleFactor, h: 100 * scaleFactor, color: "#f00fff" },
    { x: 300 * scaleFactor, y: 200 * scaleFactor, w: 100 * scaleFactor, h: 200 * scaleFactor, color: "#ffffff" },
    { x: 100 * scaleFactor, y: 300 * scaleFactor, w: 200 * scaleFactor, h: 100 * scaleFactor, color: "#00F00F" },
    { x: 400 * scaleFactor, y: 200 * scaleFactor, w: 100 * scaleFactor, h: 200 * scaleFactor, color: "#00FF00" },
    { x: 500 * scaleFactor, y: 200 * scaleFactor, w: 100 * scaleFactor, h: 200 * scaleFactor, color: "#F0000F" }
  ];
}

function draw() {
  background(255);

  for (let i = 0; i < rects.length; i++) {
    let rectObj = rects[i];
    fill(rectObj.color);
    rect(rectObj.x, rectObj.y, rectObj.w, rectObj.h);
    strokeWeight(50);
  }

  // Swap 애니메이션 진행
  if (swappingRects.length > 0) {
    let elapsed = millis() - swapStartTime;
    let t = map(elapsed, 0, swapDuration, 0, 1);

    for (let i = 0; i < swappingRects.length; i += 2) {
      let rect1 = swappingRects[i];
      let rect2 = swappingRects[i + 1];

      rect1.x = lerp(rect1.startX, rect1.endX, t);
      rect1.y = lerp(rect1.startY, rect1.endY, t);
      rect2.x = lerp(rect2.startX, rect2.endX, t);
      rect2.y = lerp(rect2.startY, rect2.endY, t);
    }

    if (elapsed >= swapDuration) {
      swappingRects = [];
      isSwapping = false; // Swap 애니메이션 종료
    }
  }
}

function swapRects() {
  if (!isSwapping) { // Swap 애니메이션이 진행 중이 아닐 때만 실행
    let i = floor(random(rects.length));
    let j = floor(random(rects.length));
    while (i === j) {
      j = floor(random(rects.length));
    }

    swappingRects = [rects[i], rects[j]];
    swapStartTime = millis();
    isSwapping = true; // Swap 애니메이션 시작

    for (let k = 0; k < swappingRects.length; k++) {
      swappingRects[k].startX = swappingRects[k].x;
      swappingRects[k].startY = swappingRects[k].y;
    }

    let tempX = rects[i].x;
    let tempY = rects[i].y;
    rects[i].endX = rects[j].x;
    rects[i].endY = rects[j].y;
    rects[j].endX = tempX;
    rects[j].endY = tempY;
  }
}

function windowResized() {
  resizeCanvas(windowWidth/2, windowHeight);

  let scaleFactor = windowHeight / 400;

  for (let i = 0; i < rects.length; i++) {
    rects[i].x *= scaleFactor;
    rects[i].y *= scaleFactor;
    rects[i].w *= scaleFactor;
    rects[i].h *= scaleFactor;
  }
}

setInterval(swapRects, swapInterval);
    </script>
  </body>
</html>
